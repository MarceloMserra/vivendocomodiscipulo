<div class="px-4 pt-4 pb-20 animate-fade-in-down">
    <a href="/login" class="inline-flex items-center gap-2 text-xs font-bold text-white/60 hover:text-white mb-8 transition pl-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
        Voltar
    </a>
    
    <div class="text-center mb-8">
        <h2 class="text-2xl font-serif font-bold text-white mb-1">Criar Conta</h2>
        <p class="text-white/50 text-sm">Junte-se à nossa comunidade digital.</p>
    </div>

    <form id="registerForm" class="w-full space-y-4 glass-panel p-6 rounded-3xl border border-white/10">
        <div>
            <label class="block text-[10px] font-bold text-white/60 uppercase mb-2 ml-1">Nome Completo</label>
            <input type="text" id="name" required class="w-full p-4 rounded-xl bg-black/20 border border-white/10 text-white outline-none focus:border-imbb-gold transition text-sm" placeholder="Ex: Marcelo Madureira">
        </div>

        <div>
            <label class="block text-[10px] font-bold text-white/60 uppercase mb-2 ml-1">WhatsApp</label>
            <input type="tel" id="whatsapp" required class="w-full p-4 rounded-xl bg-black/20 border border-white/10 text-white outline-none focus:border-imbb-gold transition text-sm" placeholder="(61) 99999-9999">
        </div>

        <div>
            <label class="block text-[10px] font-bold text-white/60 uppercase mb-2 ml-1">E-mail</label>
            <input type="email" id="email" required class="w-full p-4 rounded-xl bg-black/20 border border-white/10 text-white outline-none focus:border-imbb-gold transition text-sm" placeholder="seu@email.com">
        </div>

        <div class="grid grid-cols-2 gap-3">
            <div>
                <label class="block text-[10px] font-bold text-white/60 uppercase mb-2 ml-1">Senha</label>
                <input type="password" id="password" required minlength="6" class="w-full p-4 rounded-xl bg-black/20 border border-white/10 text-white outline-none focus:border-imbb-gold transition text-sm" placeholder="******">
            </div>
            <div>
                <label class="block text-[10px] font-bold text-white/60 uppercase mb-2 ml-1">Repetir Senha</label>
                <input type="password" id="confirmPassword" required minlength="6" class="w-full p-4 rounded-xl bg-black/20 border border-white/10 text-white outline-none focus:border-imbb-gold transition text-sm" placeholder="******">
            </div>
        </div>

        <div class="bg-white/5 p-4 rounded-xl border border-white/10 mt-2">
            <p class="text-xs text-white/80 font-bold mb-3">Você já participa de um PGM?</p>
            <div class="flex items-center gap-6 mb-3">
                <label class="flex items-center gap-2 text-sm text-white cursor-pointer">
                    <input type="radio" name="hasGroup" value="yes" onclick="toggleLeaderInput(true)" class="accent-imbb-gold w-4 h-4"> Sim
                </label>
                <label class="flex items-center gap-2 text-sm text-white cursor-pointer">
                    <input type="radio" name="hasGroup" value="no" checked onclick="toggleLeaderInput(false)" class="accent-imbb-gold w-4 h-4"> Não
                </label>
            </div>
            <div id="leaderInput" class="hidden animate-fadeIn">
                <input type="text" id="leaderName" class="w-full p-3 rounded-lg bg-black/20 border border-white/10 text-white text-sm outline-none focus:border-imbb-gold" placeholder="Nome do seu Líder">
            </div>
        </div>

        <p id="errorMsg" class="text-red-300 text-xs text-center hidden font-bold bg-red-500/20 p-2 rounded"></p>

        <button type="submit" class="w-full bg-imbb-gold text-imbb-navy py-4 rounded-xl font-bold shadow-lg mt-6 hover:scale-[1.02] transition uppercase text-xs tracking-wider">
            Finalizar Cadastro
        </button>
    </form>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCTB6wkVIfnwx009A67bv8Ar58YpD-59Z8",
        authDomain: "vivendo-como-discipulo.firebaseapp.com",
        projectId: "vivendo-como-discipulo",
        storageBucket: "vivendo-como-discipulo.firebasestorage.app",
        messagingSenderId: "1086407430526",
        appId: "1:1086407430526:web:d57784df6283c51729a32f",
        measurementId: "G-5JV8QRSMXQ"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    window.toggleLeaderInput = (show) => {
        const el = document.getElementById('leaderInput');
        if(show) el.classList.remove('hidden');
        else el.classList.add('hidden');
    }

    document.getElementById('registerForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const whatsapp = document.getElementById('whatsapp').value;
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        const leaderName = document.getElementById('leaderName').value;
        const btn = e.target.querySelector('button');
        const errorMsg = document.getElementById('errorMsg');

        if (password !== confirmPassword) {
            errorMsg.innerText = "As senhas não coincidem!";
            errorMsg.classList.remove('hidden');
            return;
        }

        try {
            btn.innerText = "CRIANDO...";
            btn.disabled = true;
            
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            const user = userCredential.user;

            await updateProfile(user, { displayName: name });

            await setDoc(doc(db, "users", user.uid), {
                name: name,
                email: email,
                whatsapp: whatsapp,
                role: "membro", 
                pgmId: null,
                requestedLeader: leaderName || null,
                photoUrl: null,
                createdAt: new Date()
            });

            localStorage.setItem('userUid', user.uid);
            localStorage.setItem('userName', name);

            alert("Bem-vindo(a), " + name + "!");
            window.location.href = '/';
        } catch (error) {
            console.error(error);
            errorMsg.innerText = "Erro: " + error.message;
            errorMsg.classList.remove('hidden');
            btn.innerText = "TENTAR NOVAMENTE";
            btn.disabled = false;
        }
    });
</script>